# Disease Entity Linking 테스트 리포트

> 실행 일시: 2026-01-07 09:21:08

---

## 1. 테스트 개요

| 항목 | 값 |
|------|---|
| 목적 | 통합 Gazetteer(v2)로 Disease 링킹 성능 검증 |
| 입력 데이터 | `pilot_sentences_50_labeled.jsonl` (50문장) |
| Gazetteer | `disease_gazetteer.json` (53,944 엔트리) |
| 스크립트 | `entity_linking_disease.py` |
| 출력 | `disease_linking_result_v2.jsonl` |

---

## 2. 버전 비교

### 2.1 데이터 소스 차이

| 버전 | 파일 | 소스 | 엔트리 수 |
|------|------|------|----------|
| v1 | `kcd9_full.json` | KCD-9 | 54,125 |
| v2 | `disease_gazetteer.json` | KCD-9 + 상병마스터 + 별칭 | 53,944 (인덱스 60,694) |

### 2.2 성능 비교

| 지표 | v1 (2026-01-06) | v2 (2026-01-07) | 변화 |
|------|-----------------|-----------------|------|
| **총 매칭률** | 82.9% (58/70) | **97.1% (68/70)** | **+14.2%** |
| exact_match | 0 (0.0%) | **40 (57.1%)** | **+57.1%** |
| partial_match | 54 (77.1%) | 28 (40.0%) | -37.1% |
| fuzzy_match | 4 (5.7%) | 0 (0.0%) | -5.7% |
| no_match | 12 (17.1%) | **2 (2.9%)** | **-14.2%** |

---

## 3. 상세 결과

### 3.1 정확 매칭 성공 (exact_match)

암별칭 추가로 정확 매칭 가능해진 질병들:

| 엔티티 | KCD 코드 | 매핑된 이름 | 비고 |
|--------|----------|-------------|------|
| 간암 | C229 | 간암 | 별칭 추가 |
| 대장암 | C189 | 대장암 | 별칭 추가 (v1에서 no_match) |
| 유방암 | C509 | 유방암 | 별칭 추가 |
| 위암 | C169 | 위암 | 별칭 추가 |
| 전립선암 | D075 | 전립선암 | 별칭 추가 |
| 혈액암 | C959 | 혈액암 | 별칭 추가 (v1에서 no_match) |
| 자궁경부암 | C539 | 자궁경부암 | 별칭 추가 |
| 폐암 | C349 | 폐암 | 별칭 추가 |
| 갑상선암 | C739 | 갑상선암 | 별칭 추가 |
| 췌장암 | C259 | 췌장암 | 별칭 추가 (v1에서 no_match) |

### 3.2 부분 매칭 (partial_match)

| 엔티티 | KCD 코드 | 매핑된 이름 | score |
|--------|----------|-------------|-------|
| 질병군 | F23 | 망상, 환각 및 지각장애와 같은 정신병적 증상의 급성... | 0.85 |
| 질환 | A00-B99 | Ⅰ.특정 감염성 및 기생충성 질환(A00-B99) | 0.85 |
| 질병 | A02.2 | 살모넬라 신세뇨관-간질병(N16.0*) | 0.85 |
| 부상 | D06 | 중증 이형성에 대한 언급이 있거나 없는 자궁경부상피내신... | 0.85 |
| 암 | C00-C97 | 신생물의 항암제에 대한 내성... | 0.85 |
| 통증 | A97 | 뎅기는 뎅기바이러스에 감염된 모기에 물림으로... | 0.85 |

**문제점**: "질병", "질환", "암" 같은 일반 용어가 실제 KCD 코드와 부정확하게 매칭됨.

### 3.3 매칭 실패 (no_match)

| 엔티티 | 분석 |
|--------|------|
| 환자군 | 질병이 아닌 집단 분류 용어. Disease 라벨링 오류 가능성 |

---

## 4. 개선 효과 분석

### 4.1 암별칭 추가 효과

v1에서 no_match였던 항목 중 v2에서 exact_match로 개선된 항목:

| 엔티티 | v1 상태 | v2 상태 | 개선 원인 |
|--------|---------|---------|-----------|
| 대장암 | no_match | exact_match | 별칭 "대장암 → C189" 추가 |
| 혈액암 | no_match | exact_match | 별칭 "혈액암 → C959" 추가 |
| 췌장암 | no_match | exact_match | 별칭 "췌장암 → C259" 추가 |

### 4.2 이름 인덱스 확장 효과

| 항목 | v1 | v2 |
|------|----|----|
| 원본 엔트리 | 54,125 | 53,944 |
| 이름 인덱스 | ~54,000 | **60,694** |

괄호 앞 이름 추출 + 별칭 추가로 검색 가능 이름 증가.

---

## 5. 남은 문제

### 5.1 일반 용어 오매칭

"질병", "질환", "암", "통증" 같은 일반 용어가 부분 매칭으로 잘못된 KCD 코드에 매핑됨.

**개선 방안:**
1. 일반 용어 블랙리스트 추가
2. 최소 문자 길이 제한 강화
3. Disease 라벨 스키마 재정의 (일반 용어 제외)

### 5.2 라벨링 품질 이슈

"환자군", "질병군" 등은 Disease가 아닌 집단/분류 용어.

**개선 방안:**
- 라벨 스키마에 "DiseaseGroup" 또는 "PopulationGroup" 추가 검토

---

## 6. 결론

| 항목 | 결과 |
|------|------|
| 목표 | 통합 Gazetteer로 매칭률 개선 |
| 결과 | **성공** (82.9% → 97.1%) |
| 핵심 개선 | 암별칭 추가로 exact_match 0% → 57.1% |
| 추가 작업 | 일반 용어 필터링, 라벨 스키마 검토 |

---

## 7. 파일 위치

| 항목 | 경로 |
|------|------|
| 스크립트 | `project/ner/scripts/entity_linking_disease.py` |
| 입력 데이터 | `project/ner/data/pilot_labeling/pilot_sentences_50_labeled.jsonl` |
| Gazetteer | `project/ner/data/gazetteer/disease_gazetteer.json` |
| 출력 결과 | `project/ner/data/pilot_labeling/disease_linking_result_v2.jsonl` |
| 이전 결과 | `project/ner/data/pilot_labeling/disease_linking_result.jsonl` |
