# 한국어 의료 NER 프로젝트 로드맵

> 최종 업데이트: 2026-01-06

---

## 1. 현재 상태 요약

### 완료된 것

| 항목 | 내용 | 날짜 |
|------|------|------|
| 베이스라인 실험 | KoELECTRA F1=97%, GLiNER F1=34% | 01-05 |
| AIHub 데이터 확인 | NER 태깅 없음 (QA 형식) | 01-06 |
| 약전 데이터 평가 | Drug/Chemical 풍부, 4,672p | 01-06 |
| Gazetteer 색인 | 150만+ Drug, 5만+ Disease | 01-06 |
| 활용 방안 비교 | Tool Calling + 후처리 권장 | 01-06 |
| GLiNER2 LoRA 테스트 | 실패 (인코더 한계) | 01-06 |

### 미완료 (하다가 말은 것)

| 항목 | 상태 | 문제점 |
|------|------|--------|
| ✅ **질의(라벨) 정의** | 완료 | GraphRAG용 13개 라벨 (임상+약학+제도) |
| ✅ **골든셋 전략** | 결정됨 | 실제 사용자 질의 (`data/user_qa/`) |
| ⚠️ **실버셋 구축** | 설계만 | 실제 데이터 0개 |
| 인코더 선택 | 논의 중 | PoC 필요 (xlm-roberta 우선) |
| 풀 파인튜닝 | 미시작 | 실버셋 대기 |

---

## 2. 핵심 미해결 과제

### 2.1 질의(Query) 정의 - "무엇을 추출할 것인가?"

현재 후보:

**Option A: KBMC 스키마 준용**
```
Disease  - 질병, 증상, 의학적 상태
Body     - 신체 부위, 장기
Treatment - 치료법, 시술
```

**Option B: 확장 스키마**
```
Disease    - 질병, 증상
Body       - 신체 부위
Treatment  - 치료법, 시술
Drug       - 의약품명 (추가)
Ingredient - 성분명 (추가)
Dosage     - 용량 (추가)
```

**Option C: 도메인별 분리**
```
# 임상 도메인
Disease, Body, Treatment, Symptom

# 약학 도메인
Drug, Ingredient, Dosage, SideEffect

# 청구 도메인
Procedure, Diagnosis, DrugCode
```

**⚠️ 결정 필요**: 어떤 스키마로 갈 것인가?

---

### 2.2 골든셋 - "무엇으로 평가할 것인가?"

| 옵션 | 규모 | 품질 | 비용 | 상태 |
|------|------|------|------|------|
| KBMC 그대로 사용 | 6,150개 | 골든 | 무료 | ✅ 사용 가능 |
| 자체 골든셋 구축 | ? | 골든 | 전문가 비용 | ❌ 없음 |
| GPT-4 생성 후 검수 | ? | 실버→골든 | GPT + 검수 비용 | ❌ 없음 |

**⚠️ 결정 필요**:
- KBMC 스키마 그대로면 → KBMC 골든셋 사용 가능
- 스키마 확장하면 → 새 골든셋 필요

---

### 2.3 실버셋 - "무엇으로 학습할 것인가?"

**설계된 파이프라인** (01-06 일지):
```
[원천 텍스트]      [Gazetteer]
     │                  │
     ▼                  ▼
┌─────────────────────────────┐
│ GPT-4o + Few-shot + Tool    │
│ Calling                     │
└─────────────────────────────┘
              │
              ▼
       [NER 실버셋]
```

**원천 텍스트 후보**:
- 대한민국 약전 (4,672p)
- AIHub 의료 QA (2억 토큰)

**Gazetteer 후보**:
- pharmalex_unity (120만 Drug)
- 약가마스터 (30만 Drug)
- KCD-9 (5만 Disease)

**⚠️ 미완료**:
1. Gazetteer 데이터 통합 → 안함
2. GPT-4o 프롬프트 작성 → 안함
3. 파일럿 라벨링 (100문장) → 안함

---

## 3. 의존 관계

```
┌─────────────────────────────────────────────────────────┐
│                    의존 관계 다이어그램                   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌───────────────┐                                      │
│  │ 1. 질의 정의   │ ◄─── 가장 먼저 결정해야 함           │
│  │ (라벨 스키마)  │                                      │
│  └───────┬───────┘                                      │
│          │                                              │
│          ▼                                              │
│  ┌───────────────┐     ┌───────────────┐               │
│  │ 2. 골든셋     │     │ 3. 실버셋     │               │
│  │ (평가 기준)   │     │ (학습 데이터)  │               │
│  └───────┬───────┘     └───────┬───────┘               │
│          │                     │                        │
│          ▼                     ▼                        │
│  ┌─────────────────────────────────────┐               │
│  │ 4. 인코더 선택 + 파인튜닝            │               │
│  │ (모델 학습)                          │               │
│  └───────────────────┬─────────────────┘               │
│                      │                                  │
│                      ▼                                  │
│              ┌───────────────┐                         │
│              │ 5. 평가       │                         │
│              │ (골든셋 기준)  │                         │
│              └───────────────┘                         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 4. 수정된 로드맵

### Phase 0: 태스크 정의 (선결 과제)

| Step | 작업 | 산출물 | 소요 |
|------|------|--------|------|
| 0.1 | 라벨 스키마 결정 | 스키마 문서 | 논의 1시간 |
| 0.2 | 골든셋 전략 결정 | 평가 계획 | 논의 30분 |
| 0.3 | 실버셋 전략 확정 | 구축 계획 | 논의 30분 |

### Phase 1: 데이터 구축

| Step | 작업 | 산출물 | 소요 |
|------|------|--------|------|
| 1.1 | Gazetteer 통합 | 통합 CSV | 2시간 |
| 1.2 | GPT 프롬프트 설계 | 프롬프트 템플릿 | 2시간 |
| 1.3 | 파일럿 라벨링 (100개) | 샘플 JSONL | 1시간 |
| 1.4 | 품질 검토 | 수정된 프롬프트 | 1시간 |
| 1.5 | 대량 생성 (5,000개) | 실버셋 JSONL | 3시간 |

### Phase 2: 모델 개발

| Step | 작업 | 산출물 | 소요 |
|------|------|--------|------|
| 2.1 | 인코더 PoC | 호환성 확인 | 2시간 |
| 2.2 | 풀 파인튜닝 | 모델 체크포인트 | 5시간 |
| 2.3 | 하이퍼파라미터 튜닝 | 최적 설정 | 5시간 |

### Phase 3: 평가 및 반복

| Step | 작업 | 산출물 | 소요 |
|------|------|--------|------|
| 3.1 | 골든셋 평가 | F1 리포트 | 1시간 |
| 3.2 | 오류 분석 | 개선점 목록 | 2시간 |
| 3.3 | 반복 (필요시) | 개선된 모델 | - |

---

## 5. 즉시 결정 필요 사항

### Q1: 라벨 스키마

```
A) KBMC 그대로 (Disease, Body, Treatment)
   → 골든셋 있음, 빠른 시작 가능

B) 확장 (+ Drug, Ingredient, Dosage)
   → 약학 도메인 커버, 골든셋 새로 필요

C) 도메인별 분리 (임상/약학/청구)
   → 복잡, 장기 프로젝트
```

### Q2: 골든셋 전략

```
A) KBMC 사용 (6,150개)
   → 즉시 사용 가능

B) 자체 구축 (전문가)
   → 비용 높음, 시간 필요

C) GPT 생성 + 검수
   → 중간 비용, 확장성
```

### Q3: 인코더 선택

```
A) xlm-roberta-base (검증됨)
   → 안전한 선택

B) klue/roberta-base (한국어 특화)
   → 성능 향상 가능, 검증 필요

C) 둘 다 실험
   → 시간 2배, 최적 선택 가능
```

---

## 6. 라벨 확장 계획

### 현재 (Phase 1): 4개 라벨

Neo4j 기존 노드와 1:1 매칭

```
Disease   → Disease 노드
Drug      → Drug 노드
Procedure → Procedure 노드
Biomarker → Biomarker 노드
```

### 확장 (Phase 2): +4개 라벨

Neo4j 스키마 확장 후 추가

| 라벨 | Neo4j 노드 | 상태 |
|------|-----------|------|
| Exam | Test | 이름만 변경 |
| Code | (속성) | kcd_code, edi_code 등 |
| Material | Material | 신규 노드 필요 |
| Benefit/Criteria | Guideline | 파생 |

### 확장 시점

1. Neo4j에 Material 노드 추가
2. CONCURRENT_RULE 엣지 추가 (동시산정)
3. cg_parsed 647건 규칙 파싱/적재

→ 그 후 GLiNER2 재학습 (8개 라벨)

---

## 7. 관련 문서

| 문서 | 경로 |
|------|------|
| 01-05 일지 (베이스라인) | `meta/journal/2026-01-05.md` |
| 01-06 일지 (데이터 조사) | `meta/journal/2026-01-06.md` |
| GLiNER2 LoRA 테스트 | `project/ner/docs/reports/gliner2_lora_test_20260106.md` |
| 풀 파인튜닝 견적 | `project/ner/docs/plans/gliner2_full_finetuning_estimate.md` |
| 인코더 선택 논의 | `project/ner/docs/plans/encoder_selection_discussion.md` |
| KBMC 비교 리포트 | `project/ner/docs/reports/kbmc_baseline_comparison_20260105.md` |
