# cancer_kcd_mapping.csv 분석 및 개선 방안

> 작성일: 2026-01-07
> 목적: 기존 자동 매핑 파일의 문제점 분석 및 NCC 데이터 활용 방안 정리

---

## 1. 파일 개요

| 항목 | 내용 |
|------|------|
| 파일 | `neo4j/data/bridges/cancer_kcd_mapping.csv` |
| 생성 스크립트 | `scripts/mapping/create_cancer_kcd_mapping.py` |
| 목적 | NCC 암종 이름 → KCD 코드 자동 매핑 |
| 엔트리 수 | 214행 (71개 암종 × 상위 3개 후보) |
| 생성 방법 | 키워드 검색 기반 자동 매칭 |

---

## 2. 자동 매핑의 치명적 오류

### 2.1 대표적 오매핑 사례

| 암종명 | 자동 매핑 (is_best_match) | 정확한 KCD | 문제점 |
|--------|---------------------------|------------|--------|
| **간암** | C02.3 (혀의 중간 3분의1) | C22.9 | "간"이 "중**간**" 등에 포함 |
| **위암** | C06.9 (작은침샘) | C16.9 | "위"가 다른 문맥에 포함 |
| **전립선암** | D07.5 (제자리암) | C61 | D코드는 악성 아님 |
| **유방암** | C43.5 (피부 흑색종) | C50.9 | 완전 다른 암종 |
| **결장암** | C18.7 (직장구불결장접합부) | C18.9 | 세부 부위가 아닌 상세불명 필요 |
| **골수이형성증후군** | C41.1 (위턱뼈암종) | D46.9 | "골"이 관련 없는 코드에 매칭 |

### 2.2 오류 원인

```
키워드 매칭 로직의 한계:
1. "간암" → 키워드 ["간"] → KCD name_kr에 "간" 포함된 코드 검색
2. C02.3 "혀의 중**간** 3분의1"이 먼저 매칭됨
3. 정확한 C22 계열보다 관련 없는 코드가 선택됨
```

### 2.3 스크립트 자체의 경고

```python
# create_cancer_kcd_mapping.py 246행
'note': '이 파일은 자동 생성되었습니다. 수동 검증이 필요합니다.'
```

**→ 수동 검증 없이 사용 불가**

---

## 3. 현재 접근법 비교

| 항목 | cancer_kcd_mapping.csv | build_gazetteer.py 별칭 |
|------|------------------------|------------------------|
| 엔트리 수 | 71개 암종 (214행) | 15개 핵심 암 |
| 생성 방법 | 자동 (키워드 매칭) | 수동 (하드코딩) |
| 정확도 | **낮음** (50% 이하) | **높음** (검증됨) |
| 검증 상태 | 미검증 | 소스 문서화됨 |
| 용도 | Neo4j 그래프 | NER Entity Linking |

---

## 4. NCC 데이터 구조

### 4.1 데이터 위치

```
data/ncc/cancer_info/parsed/
├── 위암_4661.json
├── 폐암_5237.json
├── 유방암_4757.json
├── ... (71개 암종)
```

### 4.2 JSON 구조

```json
{
  "name": "위암",              // ← 암종 통용명 (활용 가치 높음)
  "cancer_seq": "4661",        // NCC 고유 ID
  "tags": ["주요암", "성인"],
  "url": "https://www.cancer.go.kr/...",
  "content": {
    "sections": [
      {"heading": "발생부위", "content": "..."},
      {"heading": "정의 및 종류", "content": "..."},
      ...
    ]
  }
}
```

### 4.3 NCC 데이터의 특징

| 장점 | 단점 |
|------|------|
| 공신력 있는 출처 (국립암센터) | **KCD 코드가 없음** |
| 71개 암종 완전 목록 | 통용명만 있음 |
| cancer_seq로 추적 가능 | KCD 매핑은 별도 작업 필요 |

---

## 5. 활용 방안

### 5.1 현실적 접근

**NCC 암종명 추출은 쉽다 → KCD 매핑이 문제**

```
NCC 데이터 활용 흐름:
1. NCC에서 암종명 추출 (71개) ← 자동화 가능
2. KCD 코드 매핑 (71개) ← 수동 검증 필수
3. Gazetteer에 추가
```

### 5.2 작업 분담

| 작업 | 담당 | 비고 |
|------|------|------|
| NCC 암종명 추출 | 자동화 | 파일명에서 추출 |
| KCD 코드 매핑 검증 | **수동** | cancer_kcd_mapping.csv 검토 |
| Gazetteer 통합 | 자동화 | 검증된 매핑 사용 |

### 5.3 수동 검증 방법

1. `neo4j/data/bridges/cancer_kcd_mapping.csv` 열기
2. 각 암종별 `is_best_match=YES` 행의 `kcd_code` 검증
3. 잘못된 경우 rank 2, 3 후보 확인 또는 직접 입력
4. 검증 완료된 행만 Gazetteer에 추가

---

## 6. 검증 우선순위

### 6.1 주요 암 (우선 검증)

| 암종 | 현재 매핑 | 검증 필요 | 예상 정확 코드 |
|------|----------|----------|---------------|
| 위암 | C06.9 | **필요** | C16.9 |
| 폐암 | C34.00 | 검토 | C34.9 |
| 간암 | C02.3 | **필요** | C22.9 |
| 대장암 | C18.7 | 검토 | C18.9 |
| 유방암 | C43.5 | **필요** | C50.9 |
| 전립선암 | D07.5 | **필요** | C61 |
| 췌장암 | C25.7 | 검토 | C25.9 |
| 갑상선암 | - | 추가 | C73 |

### 6.2 검증 체크리스트

- [ ] 주요 암 15종 (build_gazetteer.py와 일치 확인)
- [ ] 백혈병 계열 (C91-C95)
- [ ] 림프종 계열 (C81-C88)
- [ ] 육종 계열 (C40-C49)
- [ ] 기타 희귀암

---

## 7. 검증 완료 (2026-01-07)

### 7.1 수동 검증 수행

KCD-9 데이터를 직접 조회하여 71개 NCC 암종에 대해 정확한 KCD 코드를 매핑함.

### 7.2 주요 오류 수정 내역

| 암종 | 기존 (자동) | 수정 후 | 비고 |
|------|-------------|---------|------|
| 위암 | C06.9 (작은침샘) | **C16.9** | 완전 오류 |
| 간암 | C02.3 (혀) | **C22.9** | 완전 오류 |
| 유방암 | C43.5 (피부 흑색종) | **C50.9** | 완전 오류 |
| 전립선암 | D07.5 (제자리암) | **C61** | D코드→C코드 |
| 대장암 | C18.7 (직장구불결장접합부) | **C18.9** | 세부→상세불명 |

### 7.3 검증 결과

| 항목 | 값 |
|------|------|
| 총 매핑 수 | 101개 (NCC 71개 + 동의어/변형) |
| 검증 상태 | ✅ 완료 |
| 검증 방법 | KCD-9 직접 조회 |
| 출력 파일 | `cancer_kcd_mapping_verified.csv` |

---

## 8. 결론

| 항목 | 결론 |
|------|------|
| cancer_kcd_mapping.csv (구) | 자동 생성 실패, **폐기** |
| cancer_kcd_mapping_verified.csv (신) | **검증 완료**, 사용 가능 |
| NCC 데이터 가치 | 암종명 목록 활용 완료 |
| 향후 작업 | Gazetteer에 101개 매핑 통합 |

---

## 9. 파일 위치 정리

| 파일 | 경로 | 상태 |
|------|------|------|
| **검증된 매핑** | `neo4j/data/bridges/cancer_kcd_mapping_verified.csv` | ✅ 완료 (101개) |
| 자동 매핑 (구) | `neo4j/data/bridges/cancer_kcd_mapping.csv` | ❌ 폐기 |
| 자동 매핑 스크립트 | `scripts/mapping/create_cancer_kcd_mapping.py` | - |
| NCC 암 정보 | `data/ncc/cancer_info/parsed/*.json` | 71개 |
| 검증된 별칭 | `project/ner/scripts/build_gazetteer.py` | 15개 |
| 별칭 명세 | `project/ner/docs/cancer_alias_mapping_spec.md` | 문서화됨 |
